# kaineer_microservices

![Проверки от OTUS](https://github.com/Otus-DevOps-2022-05/kaineer_microservices/actions/workflows/run-tests.yml/badge.svg)
## Курс «DevOps, практики и инструменты», часть 2, микросервисы.






### docker-3 [17]

 * Скачал hadolint, настроил чтобы работал (ну так, семь на восемь)
 * Скачал архив reddit-microservices, распаковал в microservices/src, удалил архив
 * Создал src/post-py/Dockerfile, допилил до состояния, в котором он строится
 * Довел до состояния, когда не ругается, строится и запускается
 * Повторил для src/comment/Dockerfile
 * Повторил для src/ui/Dockerfile
   * Недокопировался каталог view
   * Добавил создание каталога /app/view и копирование в него
 * Теперь скрипт поднимает приложение целиком и его видно в http://localhost:9292

 * Пробую прокинуть переменные
   * Хосты поднимаются
   * Переменные в них передаются
   * На выходе ничего нет
   * Нашел опечатку, заработало
 * Сделал в скрипте передачу переменных, все поднимается
 * Перенес src/comment на базу ruby:2-alpine
 * Перенес src/ui на базу ruby:2-alpine
 * Поправил скрипт для запуска с новыми образами
 * Добавил volume и поправил скрипт, чтобы mongo стартовал с этим volume-ом


### docker-2 [16]

 * Вдоволь накекался с опечатки dockermonolith/docker-monolith
 * Решил остановиться на варианте с дефисом, пусть будет пока
 * Посмотрел на ссылку про установку docker и решил, что я самый умный и у меня есть apt, а с остальным постепенно разберусь (так и вышло).
 * Поставил docker и docker-compose.
 * Погуглил в поисках docker-machine.
 * Поразбирался, как при помощи docker swarm делать то же самое, что делалось при помощи docker-machine.
 * После визита в чатик удостоверился, что docker swarm не будет за меня ставить docker на удаленную машину.
 * Смирился с этим и установил на удалённую машину docker сам.
 * Потыкался в основные команды docker, нашёл пару интересных (например `system df`). Остальные, разумеется, уже знал.

## Примерно тут заканчивается первая домашка и начинается вторая

 * Откопал свои настройки для yc cli
 * Запустил swarm manager на удалённом компе (у него ip-шник публичный)
 * Подцепил к нему swarm worker на своём
 * В процессе построения docker image много думал, сравнивал с предыдущими заданиями и нашёл два отличия:
   * устанавливается mongodb-server (возможно, это и правильно) вместо mongodb-org
   * зачем-то устанавливается bundler не через apt
 * После исправления этих двух отличий к исходному состоянию, всё снова запустилось.
 * Потом построил docker image и запустил на своём компе
 * .. и *быдыщ* открыл его с адреса удалённого компа. Вот тут я, конечно, некий дзен ощутил :)
 * Зарегистрировался на hub.docker.com и загрузил на него kaineer/otus-reddit:1.0
 * Слегка схалявил в задании со звездой:
   * Создал шаблон для packer, чтобы строить образ
   * Создал конфигурацию terraform, которая поднимает с этим образом инстанс, настраивает на этом инстансе питон, докер и обвязку питон-докер, чтобы запускать модуль ansible docker\_container и через провижнер local-exec сначала слепил инвентори для ansible, а потом, пользуясь этим inventory, установил и запустил образ приложеньки на инстансе.
   * К этому моменту я был несколько в офигевшем состоянии и за раскатку на несколько инстансов решил не замахиваться.
